<!--pages/ranking/ranking.wxml-->
<view class="ranking-container">
  <!-- æ ‡é¢˜ -->
  <view class="ranking-header">
    <view class="title-wrapper">
      <text class="title-decoration">ğŸ†</text>
      <text class="ranking-title">è°æ˜¯é¢„æµ‹ç‹?!</text>
      <text class="title-decoration">ğŸ†</text>
    </view>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">åŠ è½½ä¸­...</view>
  </view>
  
  <!-- é”™è¯¯æç¤º -->
  <view class="error-container" wx:elif="{{error}}">
    <view class="error-message">{{error}}</view>
    <button class="retry-btn" bindtap="loadRankings">é‡è¯•</button>
  </view>
  
  <!-- æ’åå†…å®¹ -->
  <block wx:elif="{{userRankings.length > 0}}">
    <!-- TOP 3 åŒºåŸŸ -->
    <scroll-view scroll-y="true" class="ranking-scroll">
      <view class="top-rankers">
        <view class="rank-bg"></view>
        
        <!-- ç¬¬2å -->
        <view class="rank-item-top rank-2" wx:if="{{userRankings.length > 1}}">
          <view class="rank-number">2</view>
          <view class="user-avatar">
            <image wx:if="{{userRankings[1].avatarUrl}}" class="avatar-image" src="{{userRankings[1].avatarUrl}}" mode="aspectFill"></image>
            <text wx:else class="avatar-placeholder">{{userRankings[1].nickname[0]}}</text>
          </view>
          <view class="user-name">{{userRankings[1].nickname}}</view>
          <view class="accuracy-value">{{userRankings[1].accuracy}}%</view>
          <view class="user-count" wx:if="{{userRankings[1].finishedCount > 0}}">
            {{userRankings[1].correctCount}}/{{userRankings[1].finishedCount}}
            <text class="total-votes-text">(æ€»æŠ•ç¥¨:{{userRankings[1].totalCount}})</text>
          </view>
          <view class="user-count" wx:else>0/0</view>
        </view>
        
        <!-- ç¬¬1å -->
        <view class="rank-item-top rank-1" wx:if="{{userRankings.length > 0}}">
          <view class="rank-crown">ğŸ‘‘</view>
          <view class="rank-number">1</view>
          <view class="user-avatar">
            <image wx:if="{{userRankings[0].avatarUrl}}" class="avatar-image" src="{{userRankings[0].avatarUrl}}" mode="aspectFill"></image>
            <text wx:else class="avatar-placeholder">{{userRankings[0].nickname[0]}}</text>
          </view>
          <view class="user-name">{{userRankings[0].nickname}}</view>
          <view class="accuracy-value">{{userRankings[0].accuracy}}%</view>
          <view class="user-count" wx:if="{{userRankings[0].finishedCount > 0}}">
            {{userRankings[0].correctCount}}/{{userRankings[0].finishedCount}}
            <text class="total-votes-text">(æ€»æŠ•ç¥¨:{{userRankings[0].totalCount}})</text>
          </view>
          <view class="user-count" wx:else>0/0</view>
        </view>
        
        <!-- ç¬¬3å -->
        <view class="rank-item-top rank-3" wx:if="{{userRankings.length > 2}}">
          <view class="rank-number">3</view>
          <view class="user-avatar">
            <image wx:if="{{userRankings[2].avatarUrl}}" class="avatar-image" src="{{userRankings[2].avatarUrl}}" mode="aspectFill"></image>
            <text wx:else class="avatar-placeholder">{{userRankings[2].nickname[0]}}</text>
          </view>
          <view class="user-name">{{userRankings[2].nickname}}</view>
          <view class="accuracy-value">{{userRankings[2].accuracy}}%</view>
          <view class="user-count" wx:if="{{userRankings[2].finishedCount > 0}}">
            {{userRankings[2].correctCount}}/{{userRankings[2].finishedCount}}
            <text class="total-votes-text">(æ€»æŠ•ç¥¨:{{userRankings[2].totalCount}})</text>
          </view>
          <view class="user-count" wx:else>0/0</view>
        </view>
      </view>
      
      <!-- å…¶ä»–æ’ååˆ—è¡¨æ ‡é¢˜ -->
      <view class="other-title" wx:if="{{userRankings.length > 3}}">
        å…¶ä»–æ’å
      </view>
      
      <!-- å…¶ä»–æ’ååˆ—è¡¨ -->
      <view class="other-rankers">
        <view class="rank-item-list" wx:for="{{userRankings}}" wx:key="userId" wx:if="{{index > 2}}">
          <view class="rank-number-list">{{item.rank}}</view>
          <view class="user-avatar-list">
            <image wx:if="{{item.avatarUrl}}" class="avatar-image-list" src="{{item.avatarUrl}}" mode="aspectFill"></image>
            <text wx:else class="avatar-placeholder-list">{{item.nickname[0]}}</text>
          </view>
          <view class="user-info-list">
            <view class="user-name-list">{{item.nickname}}</view>
            <view class="user-stats-list">
              <text wx:if="{{item.finishedCount > 0}}">{{item.correctCount}}/{{item.finishedCount}}</text>
              <text wx:else>0/0</text>
              <text class="total-votes-small">(æ€»:{{item.totalCount}})</text>
            </view>
          </view>
          <view class="accuracy-value-list">{{item.accuracy}}%</view>
        </view>
      </view>
    </scroll-view>
  </block>
  
  <!-- ç©ºæ•°æ®æç¤º -->
  <view class="empty-message" wx:else>
    <text class="empty-icon">ğŸ“Š</text>
    <text class="empty-text">æš‚æ— æ’åæ•°æ®</text>
    <text class="empty-desc">å½“ç”¨æˆ·é¢„æµ‹æ¯”èµ›ç»“æœåï¼Œè¿™é‡Œå°†æ˜¾ç¤ºå‡†ç¡®ç‡æ’è¡Œ</text>
  </view>
</view>